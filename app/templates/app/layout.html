{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    {% block title %}{% endblock %}
    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://use.fontawesome.com/releases/v5.8.2/css/all.css"
    />
    <!-- JQuery -->
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"
    ></script>
    <!-- Google Fonts -->
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap"
    />
    <!-- Bootstrap core CSS -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.0/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Material Design Bootstrap -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.19.1/css/mdb.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.12"></script>
    <link rel="stylesheet" href="{% static 'app/style.css' %}" />
  </head>
  <body>
    <nav class="mb-1 navbar navbar-expand-lg fixed-top navbar-dark info-color">
      <div class="container">
        {% if user.is_authenticated %}
        <a class="navbar-brand" href="{% url 'home' %}">Attendance</a>
        {% else %}
        <a class="navbar-brand" href="{% url 'login' %}">Attendance</a>
        {% endif %}
        <button
          class="navbar-toggler"
          type="button"
          data-toggle="collapse"
          data-target="#navbarSupportedContent-4"
          aria-controls="navbarSupportedContent-4"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent-4">
          <ul class="navbar-nav ml-auto">
            <li class="nav-item">
              <a class="nav-link" href="#"> About </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#"> Contact</a>
            </li>
            {% if user.is_authenticated %}
            <li class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle"
                id="navbarDropdownMenuLink-4"
                data-toggle="dropdown"
                aria-haspopup="true"
                aria-expanded="false"
              >
                <i class="fas fa-user"></i> {{user.first_name}}
                {{user.last_name}}
              </a>
              <div
                class="dropdown-menu dropdown-menu-right dropdown-info"
                aria-labelledby="navbarDropdownMenuLink-4"
              >
                <a
                  class="dropdown-item"
                  type="button"
                  href="#"
                  data-target="#user-info-modal"
                  data-toggle="modal"
                >
                  Account Info
                </a>
                <a class="dropdown-item" href="{% url 'logout' %}"> Log out </a>
              </div>
            </li>
            {% endif %}
          </ul>
        </div>
      </div>
    </nav>
    <!--/.Navbar -->
    <div
      class="modal fade"
      id="user-info-modal"
      tabindex="-1"
      role="dialog"
      aria-labelledby="myModalLabel"
      aria-hidden="true"
    >
      <div
        class="modal-dialog modal-lg modal-dialog-centered modal-notify modal-info"
        role="document"
      >
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title w-500 white-text" id="myModalLabel">
              {{user.first_name}} {{user.last_name}}'s Info
            </h4>
            <button
              type="button"
              class="close white-text"
              data-dismiss="modal"
              aria-label="Close"
            >
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <div id="display-info">
              <div class="row">
                {% if user.is_teacher %}
                <div class="col-md-6">
                  <h5>Name : {{user.first_name}} {{user.last_name}}</h5>
                </div>
                <div class="col-md-6">
                  <h5>Email Address : {{user.email}}</h5>
                </div>
                <div class="col-md-6">
                  <h5>Date of birth : {{user.date_of_birth}}</h5>
                </div>
                <div class="col-md-6">
                  <h5>Phone Number : {{user.phone}}</h5>
                </div>
                <div class="col-md-6">
                  <h5>Gender : {{user.gender}}</h5>
                </div>
                <div class="col-md-6">
                  <h5>Teacher Type : {{user.teacher_type}}</h5>
                </div>
                <div class="col-md-6">
                  <div class="row">
                    <h5 class="ml-3">Department :</h5>
                    {% for department in user.department.all %}
                    <h5 class="ml-2" id="t-department-list">
                      {{ department }}
                    </h5>
                    {% endfor %}
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="row">
                    <h5 class="ml-3">Year :</h5>
                    {% for year in user.years.all %}
                    <h5 class="ml-2" id="t-year-list">{{ year }},</h5>
                    {% endfor %}
                  </div>
                </div>
                {% endif %}
                <!--student  -->
                {% if user.is_student %}
                <div class="col-md-6">
                  <h5>Name : {{user.first_name}} {{user.last_name}}</h5>
                </div>
                <div class="col-md-6">
                  <h5>Email Address : {{user.email}}</h5>
                </div>
                <div class="col-md-6">
                  <h5>Date of birth : {{user.date_of_birth}}</h5>
                </div>
                <div class="col-md-6">
                  <h5>Phone Number : {{user.phone}}</h5>
                </div>
                <div class="col-md-6">
                  <h5>Gender : {{user.gender}}</h5>
                </div>
                <div class="col-md-6">
                  <h5>Teacher Type : {{user.student_id}}</h5>
                </div>
                <div class="col-md-6">
                  <div class="row">
                    <h5 class="ml-3">Department :</h5>
                    {% for department in user.department.all %}
                    <h5 class="ml-2">{{ department }}</h5>
                    {% endfor %}
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="row">
                    <h5 class="ml-3">Year :</h5>
                    {% for year in user.years.all %}
                    <h5 class="ml-2">{{ year }}</h5>
                    {% endfor %}
                  </div>
                </div>
                {% endif %}
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              id="edit-info-btn"
              class="btn btn-outline-info btn-sm text-capitalize"
            >
              Edit Info
            </button>
            <button
              type="button"
              class="btn btn-info btn-sm text-capitalize"
              id="close-info-btn"
              data-dismiss="modal"
            >
              Close
            </button>
          </div>
        </div>
      </div>
    </div>

    {% if user.is_authenticated %}
    <div
      class="modal fade"
      id="edit-info-modal"
      tabindex="-1"
      role="dialog"
      aria-labelledby="edit-info-label"
      aria-hidden="true"
    >
      <div
        class="modal-dialog modal-lg modal-dialog-centered modal-notify modal-info"
        role="document"
      >
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title w-500 white-text" id="edit-info-label">
              Edit Info
            </h4>
          </div>
          <form
            action="{% url 'update_user' user.id %}"
            method="POST"
            id="edit-user-form"
          >
            {% csrf_token %}
            <div class="modal-body">
              <div class="row">
                <div class="col-md-4 md-form">
                  {{eForm.email}}
                  <label for="" class="ml-3">Email Address</label>
                </div>
                <div class="col-md-4 md-form">
                  {{eForm.first_name}}
                  <label for="" class="ml-3">First Name</label>
                </div>
                <div class="col-md-4 md-form">
                  {{eForm.last_name}}
                  <label for="" class="ml-3">Last Name</label>
                </div>
                <div class="col-md-4 md-form">
                  {{eForm.date_of_birth}}
                  <label for="" class="ml-3">Date of Birth</label>
                </div>
                <div class="col-md-4 md-form">
                  {{eForm.phone}}
                  <label for="" class="ml-3">Phone Number</label>
                </div>
                <div class="col-md-4">
                  <label for="" class="ml-3">Gender</label>
                  {{eForm.gender}}
                </div>
                {% if user.is_teacher %}
                <div class="col-md-4">
                  <label for="" class="ml-3">Teacher Type</label>
                  {{eForm.teacher_type}}
                </div>
                {% endif %} {% if user.is_student %}
                <div class="col-md-4 md-form">
                  {{eForm.student_id}}
                  <label for="" class="ml-3">Student ID</label>
                </div>
                {% endif %}
                <div class="col-md-4">
                  <label for="" class="ml-3">Department</label>
                  <div class="row" id="t-department-check">
                    {% for department in eForm.department %}
                    <h6 class="ml-1">{{department}}</h6>
                    {% endfor %}
                  </div>
                  <small id="edit-user-department-error"></small>
                </div>
                <div class="col-md-4">
                  <label for="" class="ml-3">Year</label>
                  <div class="row" id="t-year-check">
                    {% for year in eForm.years %}
                    <h6 class="ml-2">{{year}}</h6>
                    {% endfor %}
                  </div>
                  <small id="edit-user-years-error"></small>
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button
                type="submit"
                id="edit-info-btn"
                class="btn btn-info btn-sm text-capitalize"
              >
                Done
              </button>
              <button
                type="button"
                id="edit-info-close-btn"
                class="btn btn-outline-info btn-sm text-capitalize"
              >
                Back
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
    {% endif %}

    <!-- Content -->
    <div class="container" id="block-content">{% block content %}{% endblock %}</div>
    <!-- End content -->
    
    <script src="{% static 'app/layout.js' %}"></script>

    <!-- Bootstrap tooltips -->
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.4/umd/popper.min.js"
    ></script>
    <!-- Bootstrap core JavaScript -->
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.0/js/bootstrap.min.js"
    ></script>
    <!-- MDB core JavaScript -->
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.19.1/js/mdb.min.js"
    ></script>
    {% block javascript %}{% endblock %}
    <script>
      $(function () {
        $("#choose-user-modal").modal("show");
        $("#fill-department-close-btn").hide();
        $("#teacher-btn").click(function () {
          $("#choose-user-modal").modal("hide");
        });
        $("#student-btn").click(function () {
          $("#choose-user-modal").modal("hide");
        });
        $("#edit-info-btn").click(function () {
          $("#user-info-modal").modal("hide");
          $("#edit-info-close-btn").show();
          $("#edit-info-modal").modal("show");
        });
        $("#edit-info-close-btn").click(function () {
          $("#edit-info-modal").modal("hide");
          $("#user-info-modal").modal("show");
        });
        var length = $("#t-department-check .edit-user-department").length;
        var ylength = $("#t-year-check .edit-user.years").length;
        console.log("length of checkboxes " + length);
        console.log("length of year" + ylength);
        var checked = $("#t-department-check .edit-user-department:checked")
          .length;
        var ychecked = $("#t-year-check .edit-user-years:checked").length;
        console.log("length of checked " + checked);
        console.log("length of years checked " + ychecked);
        if (
          (checked != 0 && checked <= length) ||
          (ychecked != 0 && ychecked <= ylength)
        ) {
          console.log("Hide");
          $("#fill-department-modal").modal("hide");
        } else if (checked == 0 || ychecked == 0) {
          $("#fill-department-modal").modal("show");
        }
      });
    </script>
  </body>
</html>
